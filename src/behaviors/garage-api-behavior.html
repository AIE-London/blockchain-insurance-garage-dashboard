<script>
    var GarageAPIBehavior = {
        properties: {
            _endpoint: {
                value: 'https://blockchain-insurance.eu-gb.mybluemix.net',
            },
            _mockEndpoint: {
                value: 'https://aston-wiremock.eu-gb.mybluemix.net',
            },
        },
        _garageApi: function (){
            let _endpoint = this._endpoint;
            let _mockEndpoint = this._mockEndpoint;
            return {
                submitReport: function (token, notes, wrightOff, estimatedValue, claimID, username) {
                    let headers = new Headers();
                    headers.append("Content-Type", "application/json");
                    return fetch(_endpoint + '/garage/'+username+'/report',{
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({
                            claimId: "C3",
                            estimatedCost: estimatedValue,
                            notes: notes,
                            writeOff: writeOff
                        })
                    }).then(function(response) {
                        console.log(response);
                        if (response.status && response.status !== 200) {
                            throw new Error("Failed to login");
                        }
                        return response.headers.get('Token');
                    });
                },

                login: function (username, password) {
                    let headers = new Headers();
                    headers.append("Content-Type", "application/json");
                    return fetch(_endpoint + '/auth',{
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({
                            username: username,
                            password: password
                        })
                    }).then(function(response) {
                        console.log(response);
                        if (response.status && response.status !== 200) {
                            throw new Error("Failed to login");
                        }
                        return response.headers.get('Token');
                    });
                },

                getClaim: function (claimId,token) {
                    let headers = new Headers();
                    headers.append("Content-Type", "application/json");
                    headers.append("authorization", "bearer " + token);
                    return fetch(_mockEndpoint + '/claim/'+ claimId,{
                        method: 'GET',
                        headers: headers,
                    }).then(function (response) {
                        console.log(response);
                        return response.json();
                    }).then(function(json){
                        console.log(json);
                        return json;
                    });
                }
            }
        }
    }
</script>